---
title: 'Ch3: Linear Regression Applied Exercises'
author: "Kylie"
date: "30/03/2019"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#install.packages("GGally")
#install.packages("skimr")
library(ISLR) # data sets for the ISLR book
library (MASS)
library(GGally) # for ggpairs
library(tidyverse) # loads packages including ggplot2, dplyr
library(skimr) # for nicer summaries using skim
library(cowplot) # for plot_grid
library(corrplot)
```

## Exercise 8

This question involves the use of simple linear regression on the `Auto`
data set.

**(a) Use the `lm()` function to perform a simple linear regression with `mpg` as the response and `horsepower` as the predictor.** Use the `summary()` function to print the results. Comment on the output.

```{r 8_a}

lm_Auto <- lm(mpg ~ horsepower, data = Auto)

summary(lm_Auto)
```

For example:

**i. Is there a relationship between the predictor and the response?**

Yes there is a statistically significant relationship between the predictor and the response.

**ii. How strong is the relationship between the predictor and the response?**

Does this refer to the statistical significance or the size of the effect?

A one unit change in horsepower causes a 0.15 unit decrease in miles per gallon. Since the range of `mpg` is `r range(Auto$mpg)` then this doesn't seem like a large/strong effect.

**iii. Is the relationship between the predictor and the response positive or negative?**

Negative.

**iv. What is the predicted `mpg` associated with a `horsepower` of 98? What are the associated 95% confidence and prediction intervals?**

```{r 8_a_iv}

predict(lm_Auto, data.frame(horsepower = 98), interval = "confidence") # produces confidence intervals for the prediction of medv for a given value of horsepower

predict(lm_Auto, data.frame(horsepower = 98), interval = "prediction") # produces prediction intervals for the prediction of medv for a given value of horsepower

```

**(b) Plot the response and the predictor. Use the `abline()` function to display the least squares regression line.**

```{r 8_b}
# ggplot alternative:
theme_set(theme_bw()) # setting theme to black and white

ggplot(Auto, aes(x = mpg, y = horsepower)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE)
```

**(c) Use the `plot()` function to produce diagnostic plots of the least squares regression fit. Comment on any problems you see with the fit.**

```{r 8_c}

par(mfrow = c(2,2)) # divides the plotting region into a 2 × 2 grid of panels
plot(lm_Auto) # plotting diagnostic plots

```

There is a nonlinear relationship between `mpg` and `horsepower` that is not captured by the linear model.

## Exercise 9

This question involves the use of multiple linear regression on the `Auto` data set.

**(a) Produce a scatterplot matrix which includes all of the variables in the data set.**

```{r 9_a, fig.height = 19, fig.width = 15}

ggpairs(select(Auto, -name)) # scatterplot matrix of all variables except 'name'

```

**(b) Compute the matrix of correlations between the variables using the function `cor()`. You will need to exclude the `name` variable, which is qualitative.**

```{r 9_b}

(cor_Auto <- cor(select(Auto, -name))) # correlation matrix between all variables except 'name'

corrplot(cor_Auto, type = "upper", order = "hclust", 
         tl.col = "black", tl.srt = 45) # plots a correlogram

```


**(c) Use the `lm()` function to perform a multiple linear regression with `mpg` as the response and all other variables except `name` as the predictors. Use the `summary()` function to print the results. **

```{r 9_c}

lm_Auto_mult <- lm(mpg ~. -name, data = Auto) # multiple linear regression with mpg as response and all other variables except 'name' as predictors

summary(lm_Auto_mult)

```

**Comment on the output. For instance:**

**i. Is there a relationship between the predictors and the response?**

**ii. Which predictors appear to have a statistically significant relationship to the response?**

**iii. What does the coefficient for the year variable suggest?**

**(d) Use the `plot()` function to produce diagnostic plots of the linear regression fit.** Comment on any problems you see with the fit. Do the residual plots suggest any unusually large outliers? Does the leverage plot identify any observations with unusually high leverage?

```{r 9_d}
plot(lm_Auto_mult) # diagnostic plots
```

**(e) Use the `*` and `:` symbols to fit linear regression models with interaction effects. Do any interactions appear to be statistically significant?**

**(f) Try a few different transformations of the variables, such as `log(X)`, `√X`, `X^2`. Comment on your findings.**

# New packages/functions 

New packages/functions I've learnt during these exercises:

